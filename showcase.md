# 3. Витрина фильмов (Showcase)

Витрина — это интерфейс взаимодействия пользователя с фильмами, предназначенный для просмотра, оценки и публичного выражения своего вкуса.  
Она служит инструментом открытия нового контента, формирования личной коллекции и обмена предпочтениями с другими пользователями.

---

## 3.1. Основная концепция

- Витрина позволяет пользователю открывать фильмы и формировать свой профиль предпочтений через оценки.  
- Публичная витрина отражает вкус пользователя и служит инструментом для сравнения с другими.  
- Контент фильтруется в зависимости от оценки: положительные/нейтральные показываются публично, отрицательные учитываются только в анализе вкуса.

---

## 3.2. Типы витрин

**Общая витрина:**  
- Универсальный поток популярных или высоко оценённых фильмов.  
- Используется для первичного знакомства с фильмами и первой оценки.  
- Формируется динамически, исключая фильмы, которые пользователь уже оценил.

**Персональная витрина:**  
- Публичная коллекция личных оценок пользователя («кинополка»).  
- Отражает фильмы с оценками 3–5, скрывает 1–2, но учитывает их для анализа вкуса.  
- Позволяет находить пользователей с похожими предпочтениями и получать взаимные рекомендации.

---

## 3.3. Механика взаимодействия (Capture & Update)

- Оценка реализована через 5 Inline-кнопок `[1][2][3][4][5]` под каждой карточкой фильма.  
- Любая оценка, поставленная в любом месте системы (общий поток, поиск, чужая витрина), автоматически обновляет персональную витрину.  
- **Идемпотентность:** одна запись `tmdb_id` = один пост в витрине. Новая оценка заменяет или удаляет старую.  
- Витрина обновляется без дубликатов и с учётом предыдущих оценок пользователя.

---

## 3.4. Логика публикации (Public vs Private)

**Положительные и нейтральные оценки (3–5):**  
- Автоматически публикуются в персональной витрине.  
- Пост содержит: постер, название, год выпуска, оценку и текстовый маркер (например, `#высшийбалл` или `#хорошийбалл`).

**Отрицательные оценки (1–2):**  
- Сохраняются в базе данных для анализа вкусов.  
- Не отображаются в публичной витрине.  
- Если фильм ранее был опубликован с более высокой оценкой, старый пост удаляется.

---

## 3.5. Техническая реализация

- **Медиа-данные:** используются `telegram_file_id` для мгновенной загрузки постеров без обращения к TMDb.  
- **Управление постами:** таблица оценок хранит `showcase_message_id` для замены/удаления сообщений.  
- **Флаг публикации:** `is_public` показывает, доступен ли фильм в витрине.  
- **Поток общей витрины:** формируется динамически, кнопки «Пропустить» не используются — пользователь скроллит дальше при желании.

---

## 3.6. Социальная функция

- Сравнение вкусов между пользователями через их персональные витрины.  
- Совпадение низких оценок может использоваться как индикатор совместимости вкусов.  
- Скрытие раздражающего контента повышает релевантность чужих витрин для гостя.  
- Витрина является не рекомендацией алгоритма, а публичной коллекцией оценок, через которую пользователи открывают новые фильмы.