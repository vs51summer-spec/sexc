# Техническая спецификация: Блок 3. Витрина фильмов (Showcase)

Витрина — это интерфейс взаимодействия пользователя со своей и чужими коллекциями. Она служит инструментом для открытия нового контента и публичного выражения кинобагажа пользователя.

## 3.1. Типы витрин
1. **Общая витрина:** Универсальный бесконечный поток популярных или высокооцененных фильмов для первоначального знакомства и оценки.
2. **Персональная витрина:** Публичная коллекция личных оценок пользователя (его «кинополка»).

## 3.2. Механика взаимодействия (Capture & Update)
* **Интерфейс оценки:** 5 Inline-кнопок `[1] [2] [3] [4] [5]` под карточкой фильма.
* **Триггер захвата:** Любое нажатие на кнопку оценки в любом месте системы (общий поток, поиск, витрина другого юзера) является командой на обновление **собственной** витрины.
* **Идемпотентность:** В персональной витрине не может быть дубликатов. Одна запись `tmdb_id` соответствует одному сообщению в витрине. Новая оценка всегда заменяет или удаляет старую.

## 3.3. Логика публикации (Public vs Private)
Система фильтрует контент персональной витрины на основе ценности оценки:

* **Оценки 3–5 (Положительные/Нейтральные):**
    * Автоматически публикуются в персональную витрину пользователя.
    * Пост содержит: постер, название, год выпуска, оценку и текстовый маркер (хештег) для поиска (например: `#высшийбалл` для 5, `#хорошийбалл` для 3-4).
* **Оценки 1–2 (Отрицательные):**
    * Сохраняются в базе данных для анализа вкусов, но **не отображаются** в публичной витрине.
    * Если фильм ранее находился в витрине (например, имел оценку 4, но пользователь изменил её на 2), старый пост в витрине **удаляется**.

## 3.4. Техническая реализация
* **Медиа-данные:** Для отрисовки используется `telegram_file_id` из таблицы `movies`. Это обеспечивает мгновенную загрузку без обращения к серверам TMDb.
* **Управление сообщениями:** Для реализации логики замены/удаления, в таблицу оценок записывается `message_id` опубликованного поста.
* **Поток общей витрины:** Формируется динамически. Из выдачи исключаются фильмы, которые пользователь уже оценил. Кнопки «Пропустить» не предусмотрены — пользователь просто скроллит ленту дальше, если не хочет оценивать фильм.

---

## Предлагаемые дополнения к БД (для Блока 3)

Для управления сообщениями в Telegram-витрине необходимо расширить таблицу `user_movie_ratings`:

```sql
ALTER TABLE user_movie_ratings ADD COLUMN showcase_message_id INTEGER; -- ID сообщения для удаления/правки
ALTER TABLE user_movie_ratings ADD COLUMN is_public BOOLEAN DEFAULT FALSE; -- Флаг видимости в витрине
